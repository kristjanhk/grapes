import java.nio.file.Files

private static Properties load(String fileName) {
  FileInputStream fis = resolveFile(fileName)
  Properties props = new Properties()
  props.load(fis)
  fis.close()
  return props
}

private static FileInputStream resolveFile(String fileName) {
  java.nio.file.Path path = new File(fileName).getAbsoluteFile().toPath()
  while (true) {
    if (Files.exists(path)) {
      return new FileInputStream(path.toFile())
    }
    path = path.getParent().resolveSibling(fileName)
  }
}

def loadProperties(Project project, boolean includeSubprojects, String extKey, String fileName) {
  Properties props = load(fileName)
  project.ext.set(extKey, props)
  if (includeSubprojects) {
    project.subprojects { ext.set(extKey, props) }
  }
}

ext {
  loadProperties = this.&loadProperties
}